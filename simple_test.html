<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Test - Website Blocker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            line-height: 1.6;
        }
        .status-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
        }
        .button:hover {
            background: #0056b3;
        }
        .info {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <h1>üß™ Simple Website Blocker Test</h1>
    
    <div class="info">
        <strong>Instructions:</strong>
        <ol>
            <li>Add this domain to your extension with a 1-2 minute time limit</li>
            <li>Stay on this page and watch the status</li>
            <li>When time expires, the page should redirect to blocked.html</li>
        </ol>
    </div>
    
    <div class="status-box">
        <h2>Current Status</h2>
        <p><strong>Domain:</strong> <span id="domain">Loading...</span></p>
        <p><strong>Extension:</strong> <span id="extensionStatus">Checking...</span></p>
        <p><strong>Time Tracking:</strong> <span id="timeStatus">Checking...</span></p>
        <p><strong>Timer:</strong> <span id="timer">Waiting...</span></p>
    </div>
    
    <div style="text-align: center;">
        <button id="checkBtn" class="button">Check Extension Status</button>
        <button id="addBtn" class="button">Add This Site (2 min)</button>
        <button id="refreshBtn" class="button">Refresh Status</button>
    </div>
    
    <div class="info">
        <strong>Debug Info:</strong>
        <div id="debugInfo" style="font-family: monospace; font-size: 12px; margin-top: 10px;">
            Ready to test...
        </div>
    </div>
    
    <script>
        // Display current domain
        document.getElementById('domain').textContent = window.location.hostname;
        
        // Debug logging
        function log(message) {
            const debugInfo = document.getElementById('debugInfo');
            const timestamp = new Date().toLocaleTimeString();
            debugInfo.innerHTML += `[${timestamp}] ${message}<br>`;
            debugInfo.scrollTop = debugInfo.scrollHeight;
            console.log(message);
        }
        
        // Check extension status
        function checkStatus() {
            log('üîç Checking extension status...');
            
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                chrome.storage.sync.get(['extensionEnabled', 'websites'], function(result) {
                    const isEnabled = result.extensionEnabled !== false;
                    const websites = result.websites || [];
                    
                    document.getElementById('extensionStatus').textContent = 
                        isEnabled ? '‚úÖ Enabled' : '‚ùå Disabled';
                    
                    log(`üì¶ Extension enabled: ${isEnabled}`);
                    log(`üì¶ Websites tracked: ${websites.length}`);
                    
                    // Check if current domain is being tracked
                    const currentDomain = window.location.hostname.toLowerCase();
                    const website = websites.find(w => 
                        w.domain === currentDomain || currentDomain.endsWith('.' + w.domain)
                    );
                    
                    if (website) {
                        document.getElementById('timeStatus').textContent = 
                            `‚úÖ Tracked: ${website.timeSpent}m / ${website.timeLimit}m`;
                        
                        if (website.isLocked) {
                            document.getElementById('timer').textContent = 'üîí LOCKED';
                        } else {
                            const timeRemaining = Math.max(0, website.timeLimit - website.timeSpent);
                            document.getElementById('timer').textContent = 
                                `‚è∞ ${timeRemaining} minutes remaining`;
                        }
                        
                        log(`üéØ Found website: ${website.domain}`);
                        log(`üéØ Time: ${website.timeSpent}m / ${website.timeLimit}m`);
                        log(`üéØ Locked: ${website.isLocked}`);
                    } else {
                        document.getElementById('timeStatus').textContent = '‚ùå Not tracked';
                        document.getElementById('timer').textContent = 'Add this site to start tracking';
                        log('‚ùå Current domain not tracked');
                    }
                });
            } else {
                document.getElementById('extensionStatus').textContent = '‚ùå Extension not detected';
                document.getElementById('timeStatus').textContent = '‚ùå Extension not detected';
                document.getElementById('timer').textContent = '‚ùå Extension not detected';
                log('‚ùå Chrome extension API not available');
            }
        }
        
        // Add test website
        function addTestWebsite() {
            log('‚ûï Adding test website...');
            
            const testWebsite = {
                domain: window.location.hostname.toLowerCase(),
                timeLimit: 2, // 2 minutes
                timeSpent: 0,
                isLocked: false,
                addedDate: new Date().toDateString(),
                lastUpdateTime: null
            };
            
            chrome.storage.sync.get(['websites'], function(result) {
                const websites = result.websites || [];
                
                // Check if already exists
                if (websites.some(w => w.domain === testWebsite.domain)) {
                    log('‚ö†Ô∏è Website already exists');
                    return;
                }
                
                websites.push(testWebsite);
                
                chrome.storage.sync.set({ websites: websites }, function() {
                    log('‚úÖ Test website added successfully');
                    checkStatus();
                });
            });
        }
        
        // Refresh status
        function refreshStatus() {
            log('üîÑ Refreshing status...');
            checkStatus();
        }
        
        // Add event listeners
        document.getElementById('checkBtn').addEventListener('click', checkStatus);
        document.getElementById('addBtn').addEventListener('click', addTestWebsite);
        document.getElementById('refreshBtn').addEventListener('click', refreshStatus);
        
        // Auto-check every 10 seconds
        setInterval(checkStatus, 10000);
        
        // Initial check
        setTimeout(checkStatus, 1000);
        
        // Log page load
        log('üöÄ Simple test page loaded');
    </script>
</body>
</html> 