<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Page for Website Blocker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            background: #f5f5f5;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .timer {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            text-align: center;
            padding: 20px;
            background: #fff;
            border-radius: 8px;
            margin: 20px 0;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .debug-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ Website Blocker Extension Test Page</h1>
    
    <div class="test-section">
        <h2>Testing Instructions</h2>
        <ol>
            <li>Add this domain to your extension with a short time limit (e.g., 1-2 minutes)</li>
            <li>Stay on this page and watch the timer count down</li>
            <li>When time expires, the page should redirect to the blocked page</li>
            <li>Check that the website gets locked in the extension popup</li>
        </ol>
    </div>
    
    <div class="timer" id="timer">
        Timer will start when you add this site to the extension
    </div>
    
    <div class="test-section">
        <h2>Current Status</h2>
        <p><strong>Domain:</strong> <span id="currentDomain"></span></p>
        <p><strong>Extension Status:</strong> <span id="extensionStatus">Checking...</span></p>
        <p><strong>Time Tracking:</strong> <span id="timeTracking">Checking...</span></p>
    </div>
    
    <div class="test-section">
        <h2>Test Actions</h2>
        <button id="checkStatusBtn">Check Extension Status</button>
        <button id="checkTimeBtn">Check Time Tracking</button>
        <button id="refreshBtn">Refresh Page</button>
        <button id="addTestBtn">Add Test Website (2 min)</button>
        <button id="testTimeBtn">Test Time Update</button>
    </div>
    
    <div class="test-section">
        <h2>Debug Information</h2>
        <div class="debug-info" id="debugInfo">
            Debug information will appear here...
        </div>
        <button id="clearDebugBtn">Clear Debug Info</button>
    </div>
    
    <script>
        // Display current domain
        document.getElementById('currentDomain').textContent = window.location.hostname;
        
        // Debug logging
        function logDebug(message) {
            const debugInfo = document.getElementById('debugInfo');
            const timestamp = new Date().toLocaleTimeString();
            debugInfo.innerHTML += `[${timestamp}] ${message}<br>`;
            debugInfo.scrollTop = debugInfo.scrollHeight;
            console.log(message);
        }
        
        function clearDebugInfo() {
            document.getElementById('debugInfo').innerHTML = 'Debug information cleared...<br>';
        }
        
        // Check extension status
        function checkExtensionStatus() {
            logDebug('üîç Checking extension status...');
            
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                chrome.storage.sync.get(['extensionEnabled', 'websites'], function(result) {
                    const isEnabled = result.extensionEnabled !== false;
                    const websites = result.websites || [];
                    
                    document.getElementById('extensionStatus').textContent = 
                        isEnabled ? 'Enabled' : 'Disabled';
                    
                    logDebug(`üì¶ Extension enabled: ${isEnabled}`);
                    logDebug(`üì¶ Websites in storage: ${websites.length}`);
                    
                    // Check if current domain is being tracked
                    const currentDomain = window.location.hostname.toLowerCase();
                    const website = websites.find(w => 
                        w.domain === currentDomain || currentDomain.endsWith('.' + w.domain)
                    );
                    
                    if (website) {
                        document.getElementById('timeTracking').textContent = 
                            `Tracked: ${website.timeSpent}m / ${website.timeLimit}m (${website.isLocked ? 'LOCKED' : 'Active'})`;
                        
                        logDebug(`üéØ Found tracked website: ${website.domain}`);
                        logDebug(`üéØ Time spent: ${website.timeSpent}m / ${website.timeLimit}m`);
                        logDebug(`üéØ Locked: ${website.isLocked}`);
                        
                        // Update timer display
                        if (website.timeLimit > 0) {
                            const timeRemaining = Math.max(0, website.timeLimit - website.timeSpent);
                            document.getElementById('timer').textContent = 
                                `Time Remaining: ${timeRemaining} minutes`;
                        }
                    } else {
                        document.getElementById('timeTracking').textContent = 'Not tracked';
                        document.getElementById('timer').textContent = 'Add this site to the extension to start tracking';
                        logDebug('‚ùå Current domain not tracked');
                    }
                });
            } else {
                document.getElementById('extensionStatus').textContent = 'Extension not detected';
                document.getElementById('timeTracking').textContent = 'Extension not detected';
                logDebug('‚ùå Chrome extension API not available');
            }
        }
        
        function checkTimeTracking() {
            checkExtensionStatus();
        }
        
        function refreshPage() {
            window.location.reload();
        }
        
        // Add test website
        function addTestWebsite() {
            logDebug('‚ûï Adding test website...');
            
            const testWebsite = {
                domain: window.location.hostname.toLowerCase(),
                timeLimit: 2, // 2 minutes
                timeSpent: 0,
                isLocked: false,
                addedDate: new Date().toDateString(),
                lastUpdateTime: null
            };
            
            chrome.storage.sync.get(['websites'], function(result) {
                const websites = result.websites || [];
                
                // Check if already exists
                if (websites.some(w => w.domain === testWebsite.domain)) {
                    logDebug('‚ö†Ô∏è Website already exists');
                    return;
                }
                
                websites.push(testWebsite);
                
                chrome.storage.sync.set({ websites: websites }, function() {
                    logDebug('‚úÖ Test website added successfully');
                    checkExtensionStatus();
                });
            });
        }
        
        // Test time update
        function testTimeUpdate() {
            logDebug('‚è∞ Testing time update...');
            
            chrome.storage.sync.get(['websites'], function(result) {
                const websites = result.websites || [];
                const currentDomain = window.location.hostname.toLowerCase();
                
                const website = websites.find(w => 
                    w.domain === currentDomain || currentDomain.endsWith('.' + w.domain)
                );
                
                if (website) {
                    const newTimeSpent = website.timeSpent + 1;
                    website.timeSpent = newTimeSpent;
                    
                    chrome.storage.sync.set({ websites: websites }, function() {
                        logDebug(`‚è∞ Updated time for ${website.domain}: ${newTimeSpent}m`);
                        checkExtensionStatus();
                    });
                } else {
                    logDebug('‚ùå No website found to update');
                }
            });
        }
        
        // Add event listeners
        document.getElementById('checkStatusBtn').addEventListener('click', checkExtensionStatus);
        document.getElementById('checkTimeBtn').addEventListener('click', checkTimeTracking);
        document.getElementById('refreshBtn').addEventListener('click', refreshPage);
        document.getElementById('addTestBtn').addEventListener('click', addTestWebsite);
        document.getElementById('testTimeBtn').addEventListener('click', testTimeUpdate);
        document.getElementById('clearDebugBtn').addEventListener('click', clearDebugInfo);
        
        // Check status every 10 seconds
        setInterval(checkExtensionStatus, 10000);
        
        // Initial check
        setTimeout(checkExtensionStatus, 1000);
        
        // Log page load
        logDebug('üöÄ Test page loaded');
    </script>
</body>
</html> 